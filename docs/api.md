# API docs

Read below for detailed documentation on how to use the Bluzelle database.

{% hint style="info" %}
The Bluzelle JavaScript library works with [promises](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise) to model asynchronous behavior. Ensure that dependent calls to the Bluzelle database are within `.then()` blocks or within [asynchronous functions](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function). Also ensure that promises exceptions are caught and handled.
{% endhint %}

{% hint style="info" %}
Keys and values in the Bluzelle database are plain strings to ensure compatibility for all forms of serialization. JavaScript applications will probably want to use `JSON.stringify(obj)` and `JSON.parse(str)` to convert object data to and from string format.
{% endhint %}

## Exports

### version

The bluzelle-js version.

```javascript
const {version} = require('bluzelle');

assert(version === '0.6.843'); // your version may be different
```

### 

### bluzelle\({...}\)

Configures the Bluzelle connection. This may be called multiple times to create multiple clients.

The private key is a unique identifier for write permissions. The public key is derivable from the private key in ECDSA, so you don't need to provide it.

```javascript
const {bluzelle} = require('bluzelle');

const api = async bluzelle({
    public_pem: 'MFYwEAY...YicgEN9dgLA==',
    private_pem: 'MHQCAQEEIF...ZKIy8ejQ=='
});
```

{% hint style="info" %}
`bluzelle` and `version`are the only exports of the Bluzelle library. The calls below are methods of the object generated by calling `bluzelle`.
{% endhint %}

<table>
  <thead>
    <tr>
      <th style="text-align:left">Argument</th>
      <th style="text-align:left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align:left"><b>private_pem</b>
      </td>
      <td style="text-align:left">The private key for this user in PEM format.</td>
    </tr>
    <tr>
      <td style="text-align:left"><b>public_pem</b>
      </td>
      <td style="text-align:left">The public key for this user in PEM format.</td>
    </tr>
    <tr>
      <td style="text-align:left">ethereum_rpc</td>
      <td style="text-align:left">The remote procedure call entry point for accessing Ethereum. Defaults
        to the Infura Ropsten gateway.</td>
    </tr>
    <tr>
      <td style="text-align:left">contract_address</td>
      <td style="text-align:left">The contract address containing Bluzelle metadata. Default to our most
        up-to-date contract.</td>
    </tr>
    <tr>
      <td style="text-align:left">uuid</td>
      <td style="text-align:left">Bluzelle uses <code>UUID</code>&apos;s to identify distinct databases on
        a single swarm. We recommend using <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier#Version_4_(random)">Version 4 of the universally unique identifier</a>.
        Defaults to the public key.</td>
    </tr>
    <tr>
      <td style="text-align:left">log</td>
      <td style="text-align:left">
        <ul>
          <li>When set to <code>true</code>, logs the request and response messages with <code>console.log</code>.</li>
          <li>When set to a function, logs the request and response messages to that
            function.</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td style="text-align:left">logDetailed</td>
      <td style="text-align:left">When set to true, also logs JSON-ified versions of the database messages.</td>
    </tr>
    <tr>
      <td style="text-align:left">p2p_latency_bound</td>
      <td style="text-align:left">The upper bound for node-to-node latency on the Bluzelle network in ms.
        The client uses this number for its internal failure timing. Default is
        100.</td>
    </tr>
    <tr>
      <td style="text-align:left">onclose</td>
      <td style="text-align:left">Function to be called when the main connection closes or receives an error.</td>
    </tr>
  </tbody>
</table>## Administrative Functions

### status\(\)

Returns the status of the daemon.

```javascript
await api.status();
```

Returns JSON-encoded swarm status.

### close\(\)

Closes the connections.

```javascript
api.close();
```

Returns nothing. Never fails.

{% hint style="info" %}
Having open WebSocket connections will stop a node program from terminating. 
{% endhint %}

### \_getWriters\(\)

Gets the owner and writers of the given database. The owner is the public key of the user that created the database. The writers array lists the public keys of users that are allowed to make changes to the database.

```javascript
// promise syntax
api._getWriters().then(permissions => { ... }, error => { ... });

// async/await syntax
const permissions = await api._getWriters();
```

Returns a promise resolving to an object like this:

```javascript
{
    owner: 'MFYwEAY...EpZop6A==',
    writers: [
        'MFYwEAYH...0FEoB==',
        ...
    ]
}
```

Fails when a response is not received or the database does not exist.



### \_addWriters\(writers\)

Adds writers to the writers list. May only be executed by the owner of the database.

```javascript
// promise syntax
api._addWriters('MFYwEAY...EpZop6A==').then(() => { ... }, error => { ... });

// async/await syntax
await api._addWriters(['MFYwEAY...EpZop6A==', 'MFYwEAYH...0FEoB==']);
```

| Argument | Description |
| :--- | :--- |
| writers | A single public key or an array of public keys to add. |

Returns a promise resolving to nothing.

{% hint style="info" %}
Duplicate writers are not added to the writers list.
{% endhint %}



### \_deleteWriters\(writers\)

Deletes writers from the writers list. May only be executed by the owner of the database.

```javascript
// promise syntax
api._deleteWriters('MFYwEAY...EpZop6A==').then(() => { ... }, error => { ... });

// async/await syntax
await api._deleteWriters(['MFYwEAY...EpZop6A==', 'MFYwEAYH...0FEoB==']);
```

| Argument | Description |
| :--- | :--- |
| writers | A single public key or an array of public keys to delete. |

Returns a promise resolving to nothing.

## Database Functions

### create\(key, value\[, ttl\]\)

Create a field in the database.

```javascript
// promise syntax
api.create('mykey', '{ a: 13 }').then(() => { ... }, error => { ... });

// async/await syntax
await api.create('mykey', '{ a: 13 }');
```

| Argument | Description |
| :--- | :--- |
| key | The name of the key to create |
| value | The string value to set the key |
| ttl | \(Optional\) The field's time-to-live, in seconds. |

Returns a promise resolving to nothing.

Fails when a response is not received from the connection, the key already exists, or invalid value.

Fails when a response is not received.



### read\(key\)

Retrieve the value of a key.

```javascript
// promise syntax
api.read('mykey').then(value => { ... }, error => { ... });

// async/await syntax
const value = await api.read('mykey');
```

| Argument | Description |
| :--- | :--- |
| key | The key to retrieve |

Returns a promise resolving the string value of the key.

Fails when a response is not received or the key does not exist in the database.

### update\(key, value\[, ttl\]\)

Updates a field in the database.

```javascript
// promise syntax
api.update('mykey', '{ a: 13 }').then(() => { ... }, error => { ... });

// async/await syntax
await api.update('mykey', '{ a: 13 }');
```

| Argument | Description |
| :--- | :--- |
| key | The name of the key to create |
| value | The string value to set the key |
| ttl | \(Optional\) The field's time-to-live, in seconds. |

Returns a promise resolving to nothing.

Fails when a response is not received from the connection, the key doesn't exist, or invalid value.

Fails when a response is not received.



### quickread\(key\)

Retrieve the value of a key. Has the same interface as read. The difference with quickread is that it bypasses the consensus and cryptography mechanisms in favor of speed.

```javascript
// promise syntax
api.quickread('mykey').then(value => { ... }, error => { ... });

// async/await syntax
const value = await api.read('mykey');
```

| Argument | Description |
| :--- | :--- |
| key | The key to retrieve |

Returns a promise resolving the string value of the key.

Fails when a response is not received or the key does not exist in the database.



Update a field in the database.

```javascript
// promise syntax
api.update('mykey', '{ a: 13 }').then(() => { ... }, error => { ... });

// async/await syntax
await api.update('mykey', '{ a: 13 }');
```

| Argument | Description |
| :--- | :--- |
| key | The name of the key to update |
| value | The string value to set the key |

Returns a promise resolving to nothing.

Fails when a response is not received from the connection, the key does not exist, or invalid value.



### delete\(key\)

Deletes a field from the database.

```javascript
// promise syntax
api.delete('mykey').then(() => { ... }, error => { ... });

// async/await syntax
await bluzelle.delete('mykey');
```

| Argument | Description |
| :--- | :--- |
| key | The name of the key to delete |

Returns a promise resolving to nothing.

Fails when a response is not received from the connection or the key is not in the database.



### has\(key\)

Query to see if a key is in the database.

```javascript
// promise syntax
api.has('mykey').then(hasMyKey => { ... }, error => { ... });

// async/await syntax
const hasMyKey = await api.has('mykey');
```

| Argument | Description |
| :--- | :--- |
| key | The name of the key to query |

Returns a promise resolving to a boolean value - `true` or `false`, representing whether the key is in the database.

Fails when a response is not received from the connection.



### keys\(\)

Retrieve a list of all keys.

```javascript
// promise syntax
api.keys().then(keys => { ... }, error => { ... });

// async/await syntax
const keys = await api.keys();
```

Returns a promise resolving to an array of strings. ex. `["key1", "key2", ...]`.

Fails when a response is not received from the connection.



### size\(\)

Retrieves the size of the database in bytes.

```javascript
// promise syntax
api.size().then(size => { ... }, error => { ... });

// async/await syntax
const size = await api.size();
```

Returns a promise resolving to an integer.

Fails when a response is not received from the connection.

## Expiry Functions

### expire\(key, expiry\)

Sets an expiry on a field.

```javascript
// promise syntax
api.expire('myKey', 100).then(() => { ... }, error => { ... });

// async/await syntax
await api.expire('myKey', 100);
```

| Argument | Description |
| :--- | :--- |
| key | The name of the key |
| expiry | The number of seconds that the key will survive before being deleted. |

Returns a promise resolving to a nothing.

Fails when a response is not received from the connection or internal error.

### persist\(key\)

Removes the expiry from a field.

```javascript
// promise syntax
api.persist('myKey').then(() => { ... }, error => { ... });

// async/await syntax
await api.persist('myKey');
```

| Argument | Description |
| :--- | :--- |
| key | The name of the key |

Returns a promise resolving to a nothing.

Fails when a response is not received from the connection or internal error.

### ttl\(key\)

Returns the remaining time-to-live of the given key, in seconds.

```javascript
// promise syntax
api.ttl('myKey').then(ttl => { ... }, error => { ... });

// async/await syntax
const ttl = await api.ttl('myKey');
```

| Argument | Description |
| :--- | :--- |
| key | The name of the key |

Returns a promise resolving to an integer.

Fails when a response is not received from the connection, expiry does not exist, or internal error.


